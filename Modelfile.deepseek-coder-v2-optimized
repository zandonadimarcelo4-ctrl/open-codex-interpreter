# Modelfile otimizado para DeepSeek-Coder-V2
# Versão leve e rápida para geração de código

# Modelo base (priorizar modelo não quantizado se disponível)
FROM deepseek-coder:latest

# Sistema de prompt otimizado para código
SYSTEM """You are DeepSeek Coder, an expert AI assistant specialized in programming and code generation. 
You write clean, efficient, and well-documented code. 
Focus on:
- Code quality and best practices
- Clear, concise explanations
- Error handling and edge cases
- Performance optimization when relevant

Always provide complete, working code solutions."""

# Template otimizado para DeepSeek (formato padrão do modelo)
TEMPLATE """<|start_header_id|>system<|end_header_id|>

{{ .System }}<|eot_id|><|start_header_id|>user<|end_header_id|>

{{ .Prompt }}<|eot_id|><|start_header_id|>assistant<|end_header_id|>

{{ .Response }}<|eot_id|>"""

# Parâmetros otimizados para performance e leveza
# Temperature: 0.3 (mais determinístico, melhor para código)
PARAMETER temperature 0.3

# Top-p: 0.85 (sampling mais focado)
PARAMETER top_p 0.85

# Top-k: 30 (limitar opções, mais rápido)
PARAMETER top_k 30

# Context window: 4096 (suficiente para código médio)
PARAMETER num_ctx 4096

# Max tokens: 2048 (respostas concisas)
PARAMETER num_predict 2048

# Repeat penalty: 1.1 (evitar repetição)
PARAMETER repeat_penalty 1.1

# Repeat last N tokens: 64 (contexto de repetição)
PARAMETER repeat_last_n 64

# Threads: automático (usar todos os cores disponíveis)
PARAMETER num_thread -1

# Batch size: 512 (processamento em lote eficiente)
PARAMETER num_batch 512

# GPU layers: automático (usar GPU se disponível)
PARAMETER num_gpu -1

# Stop sequences (padrão DeepSeek)
PARAMETER stop "<|start_header_id|>"
PARAMETER stop "<|end_header_id|>"
PARAMETER stop "<|eot_id|>"
PARAMETER stop "```"
PARAMETER stop "System:"
PARAMETER stop "User:"
PARAMETER stop "Assistant:"

# Seed: -1 (aleatório, mas determinístico por padrão)
PARAMETER seed -1

# TFS: 1.0 (sem filtro de cauda)
PARAMETER tfs_z 1.0

# Typical p: 1.0 (sem filtro típico)
PARAMETER typical_p 1.0

# Mirostat: 0 (desabilitado para performance)
PARAMETER mirostat 0

# Penalize newlines: false (permitir múltiplas linhas)
PARAMETER penalize_newline false

