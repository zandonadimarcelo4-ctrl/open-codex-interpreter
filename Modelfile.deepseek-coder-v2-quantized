# Modelfile otimizado para DeepSeek-Coder-V2 (Quantizado Q4_K_M)
# Versão leve para sistemas com memória limitada

# Modelo base quantizado
FROM deepseek-coder-v2-16b-q4_k_m

# Sistema de prompt otimizado para código
SYSTEM """You are DeepSeek Coder, an expert AI assistant specialized in programming and code generation. 
You write clean, efficient, and well-documented code. 
Focus on:
- Code quality and best practices
- Clear, concise explanations
- Error handling and edge cases
- Performance optimization when relevant

Always provide complete, working code solutions."""

# Template otimizado para DeepSeek (formato padrão do modelo)
TEMPLATE """<|start_header_id|>system<|end_header_id|>

{{ .System }}<|eot_id|><|start_header_id|>user<|end_header_id|>

{{ .Prompt }}<|eot_id|><|start_header_id|>assistant<|end_header_id|>

{{ .Response }}<|eot_id|>"""

# Parâmetros otimizados para performance máxima (quantizado)
# Temperature: 0.2 (muito determinístico, ideal para código)
PARAMETER temperature 0.2

# Top-p: 0.9 (sampling focado)
PARAMETER top_p 0.9

# Top-k: 40 (boa qualidade, ainda rápido)
PARAMETER top_k 40

# Context window: 4096 (suficiente para código médio)
PARAMETER num_ctx 4096

# Max tokens: 2048 (respostas concisas)
PARAMETER num_predict 2048

# Repeat penalty: 1.15 (evitar repetição, importante em modelos quantizados)
PARAMETER repeat_penalty 1.15

# Repeat last N tokens: 64
PARAMETER repeat_last_n 64

# Threads: automático
PARAMETER num_thread -1

# Batch size: 256 (menor para modelos quantizados)
PARAMETER num_batch 256

# GPU layers: automático
PARAMETER num_gpu -1

# Stop sequences
PARAMETER stop "<|start_header_id|>"
PARAMETER stop "<|end_header_id|>"
PARAMETER stop "<|eot_id|>"
PARAMETER stop "```"
PARAMETER stop "System:"
PARAMETER stop "User:"
PARAMETER stop "Assistant:"

# Seed: -1
PARAMETER seed -1

# TFS: 1.0
PARAMETER tfs_z 1.0

# Typical p: 1.0
PARAMETER typical_p 1.0

# Mirostat: 0
PARAMETER mirostat 0

# Penalize newlines: false
PARAMETER penalize_newline false

