<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Super agente de IA com múltiplos modelos colaborativos" />
    <link rel="icon" type="image/png" href="%VITE_APP_LOGO%" />
    <link rel="apple-touch-icon" href="%VITE_APP_LOGO%" />
    <link rel="manifest" href="/manifest.json" />
    <title>%VITE_APP_TITLE%</title>
    <!-- Add Google Fonts here, example:
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    -->
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="./src/main.tsx"></script>
    <!-- Analytics (opcional - só carrega se configurado) -->
    <script>
      (function() {
        const analyticsEndpoint = '%VITE_ANALYTICS_ENDPOINT%';
        const websiteId = '%VITE_ANALYTICS_WEBSITE_ID%';
        
        // Só carregar se as variáveis estiverem definidas e não forem placeholders
        if (analyticsEndpoint && 
            websiteId && 
            analyticsEndpoint !== '%VITE_ANALYTICS_ENDPOINT%' && 
            websiteId !== '%VITE_ANALYTICS_WEBSITE_ID%' &&
            !analyticsEndpoint.includes('undefined') &&
            !websiteId.includes('undefined')) {
          const script = document.createElement('script');
          script.defer = true;
          script.src = analyticsEndpoint + '/umami';
          script.setAttribute('data-website-id', websiteId);
          document.body.appendChild(script);
        }
      })();
    </script>
    <script>
      // Registrar Service Worker para PWA (apenas em produção)
      // NÃO registrar para localhost, 127.0.0.1 ou Tailscale (.ts.net)
      // Tailscale precisa de conexões diretas sem cache do Service Worker
      (function() {
        const hostname = window.location.hostname;
        const isLocalhost = hostname === 'localhost' || hostname === '127.0.0.1' || /^\d+\.\d+\.\d+\.\d+$/.test(hostname);
        const isTailscale = hostname && hostname.endsWith('.ts.net');
        
        if ('serviceWorker' in navigator) {
          if (isLocalhost || isTailscale) {
            // Em desenvolvimento ou Tailscale, desregistrar qualquer Service Worker existente
            navigator.serviceWorker.getRegistrations().then((registrations) => {
              for (const registration of registrations) {
                registration.unregister().then(() => {
                  console.log('[SW] Service Worker desregistrado para', isTailscale ? 'Tailscale' : 'desenvolvimento');
                });
              }
            });
          } else {
            // Em produção (não localhost, não Tailscale), registrar Service Worker
            window.addEventListener('load', () => {
              navigator.serviceWorker.register('/sw.js')
                .then((registration) => {
                  console.log('[SW] Service Worker registrado:', registration.scope);
                })
                .catch((error) => {
                  console.log('[SW] Erro ao registrar Service Worker:', error);
                });
            });
          }
        }
      })();
    </script>
  </body>

</html>